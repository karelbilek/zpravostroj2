<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>dokumentace</TITLE>

<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<META name="GENERATOR" content="hevea 1.10">
<STYLE type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{margin:1em auto 1em 0px;width:50%;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
DIV TABLE{margin-left:inherit;margin-right:inherit;}
PRE{text-align:left;margin-left:0ex;margin-right:auto;}
BLOCKQUOTE{margin-left:4ex;margin-right:4ex;text-align:left;}
TD P{margin:0px;}
.boxed{border:1px solid black}
.textboxed{border:1px solid black}
.vbar{border:none;width:2px;background-color:black;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px;width:auto; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px;width:auto; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; width:20%; text-align:left;}
.marginparleft{float:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
</STYLE>
</HEAD>
<BODY >
<!--HEVEA command line is: /usr/bin/hevea dokumentace -->
<!--CUT DEF chapter 1 --><!--TOC chapter Obsah-->
<H1 CLASS="chapter"><!--SEC ANCHOR -->Obsah</H1><!--SEC END --><UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc1">Kapitola 1  Úvod</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc2">Kapitola 2  Požadavky projektu</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc3">Kapitola 3  Instalace</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc4">Kapitola 4  Moduly - přehled</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc5">4.1  Data</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc6">4.2  Infrastruktura</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc7">4.3  Výpočet</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc8">4.4  Prezentace</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc9">Kapitola 5  Popisy jednotlivých modulů</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc10">5.1  Data</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc11">5.1.1  Uložení článků</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc12">5.1.2  <TT>Zpravostroj::Article</TT></A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc13">5.2  Infrastruktura</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc14">5.2.1  Forker</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc15">5.2.2  Traversable</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc16">5.2.3  OutCounter</A>
</LI></UL>
</LI><LI CLASS="li-toc"><A HREF="#htoc17">5.3  Výpočty, prezentace</A>
<UL CLASS="toc"><LI CLASS="li-toc">
<A HREF="#htoc18">5.3.1  Postup zpracovávání článků</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc19">5.3.2  Tf-Idf témata</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc20">5.3.3  Evaluace</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc21">5.3.4  Statistiky, grafy</A>
</LI><LI CLASS="li-toc"><A HREF="#htoc22">5.3.5  Další data</A>
</LI></UL>
</LI></UL>
</LI></UL><!--TOC chapter Úvod-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc1">Kapitola 1</A>  Úvod</H1><!--SEC END --><P>
Zpravostroj je projekt, který stahuje a ukládá zprávy z vybraných internetových zdrojů. Zároveň na těchto zprávách implementuje některé formy automatické detekce zpravodajských témat, z nichž některé jsou založeny na ručním třídění. Také je implementována evaluace různých způsobů této detekce a vykreslování množství daných typů témat do grafu.</P><P>Projekt je velmi experimentální, jeho výstupy a způsoby jeho volání tedy nejsou příliš uživatelsky přívětivé a program vypisuje velké množství "dočasných" údajů. Dále je na projektu zřejmé, že byl vypracováván současně s bakalářskou prací, tudíž například metody, vykreslující grafy, vytváří právě ty grafy, které jsou použity v bakalářské práci.</P><P>Předpokládaným uživatelem je programátor v Perlu, který bude s projektem experimentovat a zkoušet jeho API.</P><P>Součástí projektu je i aplikace pro manuální označování témat, která byla původně zamýšlena jako webová aplikace pro více uživatelů, proto běží jako Facebook aplikace na adrese <A HREF="http://apps.facebook.com/zpravostroj_z/"><TT>http://apps.facebook.com/zpravostroj_z/</TT></A>; je ale ve skutečnosti umístěna na serveru <TT>ufallab2.ms.mff.cuni.cz</TT>, který bude v průběhu roku 2011 vypnut a aplikace fungovat asi přestane.</P><!--TOC chapter Požadavky projektu-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc2">Kapitola 2</A>  Požadavky projektu</H1><!--SEC END --><P>Projekt potřebuje operační systém Unixového typu a nainstalovaný <TT>Perl</TT>, minimálně ve verzi 5.8. Projekt byl testován pouze na operačních systémech s jádrem <TT>Linux</TT>, u jiných systémů by mohl být problém s nainstalováním programu <TT>TectoMT</TT>, který používám.</P><P>Program potřebuje tyto CPAN moduly:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	
	<A HREF="http://search.cpan.org/perldoc?IO::Socket"><TT>IO::Socket</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?Encode"><TT>Encode</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?forks"><TT>forks</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?Moose"><TT>Moose</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?Data::Validate::URI"><TT>Data::Validate::URI</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?HTML::Encoding"><TT>HTML::Encoding</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?LWP::UserAgent"><TT>LWP::UserAgent</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?MooseX::StrictConstructor"><TT>MooseX::StrictConstructor</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?MooseX::Storage"><TT>MooseX::Storage</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?File::Slurp"><TT>File::Slurp</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?Scalar::Util"><TT>Scalar::Util</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?Time::Local"><TT>Time::Local</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?HTML::DOM"><TT>HTML::DOM</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?HTML::HeadParser"><TT>HTML::HeadParser</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?YAML::XS"><TT>YAML::XS</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?Text::Unaccent"><TT>Text::Unaccent</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?AI::Categorizer"><TT>AI::Categorizer</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?AI::DecisionTree"><TT>AI::DecisionTree</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?Algorithm::NaiveBayes"><TT>Algorithm::NaiveBayes</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?Algorithm::SVM"><TT>Algorithm::SVM</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?Time::Progress"><TT>Time::Progress</TT></A>

</LI></UL><P>Kromě toho potřebuje program mít nainstalovaný a správně nastavený program <A HREF="http://ufal.mff.cuni.cz/tectomt/">TectoMT</A>. Pro kreslení grafů je nutné mít nainstalován program <TT>R</TT> a <TT>R</TT> balíček <TT>ggplot2</TT>.</P><P>Facebook aplikace kromě toho potřebuje tyto moduly:</P><UL CLASS="itemize"><LI CLASS="li-itemize"><P>	</P>
	<A HREF="http://search.cpan.org/perldoc?Facebook::Graph"><TT>Facebook::Graph</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?Encode"><TT>Encode</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?URI::Escape"><TT>URI::Escape</TT></A>

	</LI><LI CLASS="li-itemize">
	<A HREF="http://search.cpan.org/perldoc?CGI"><TT>CGI</TT></A>

</LI></UL><!--TOC chapter Instalace-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc3">Kapitola 3</A>  Instalace</H1><!--SEC END --><P>Celý projekt je tvořen pouze několika perlovými moduly. Pro spuštění jednotlivých úloh je nutné daný modul načíst pomocí příkazů use nebo require, přičemž musí být "hlavní adresář" (tj. adresář, nadřazený adresáři Zpravostroj) v PERL5LIB - jelikož je ale v <TT>PERL5LIB</TT> většinou obsažen odkaz na pracovní adresář <TT>.</TT>, stačí mít hlavní adresář jako pracovní adresář.</P><P>Po načtení modulu (různé moduly pro různé úkoly) je možné různé úkoly spustit jedním zavoláním procedury. Kromě modulu <TT>Zpravostroj::Globals</TT> neexportuje žádný z modulů žádné procedury, je tedy nutné psát celé názvy procedur včetně názvu modulu.</P><P>Program vypisuje velké množství pracovních výpisů na standardní výstup; toto je možné vypnout spuštěním procedury <TT>Zpravostroj::Globals::_shut_up()</TT>. Všechny kontrolní výpisy programu jsou v kódování utf-8.</P><P>Všechna data (články, výsledky analýz) zapisuje a čte program do adresáře <TT>./data/</TT>, tj. umístění je závislé na pracovním adresáři. Pokud jsou součástí projektu i stažené články (jsou na DVD k bakalářské práci, ale kvůli copyrightu je nezveřejňuji na veřejném git repository), jsou v adresáři <TT>data</TT>, který je podadresář hlavního adresáře, je tedy nutné mít hlavní adresář jako pracovní.</P><P>Stejně tak je pro kreslení grafů (viz níže) nutné mít jako podadresář pracovního adresáře adresář <TT>R_graphs</TT>, který obsahuje zdrojové kódy v jazyce R pro kreslení grafů.</P><P>Velmi tedy doporučuji mít jako pracovní adresář "hlavní adresář" projektu.</P><P>Program též zapisuje průběžná data do adresáře <TT>./tmp/</TT> pod pracovní adresář. Pokud chcete, aby program zapisoval do adresáře <TT>/tmp</TT> (například), je nutné tento adresář nalinkovat do pracovního adresáře jako <TT>./tmp/</TT>.</P><!--TOC chapter Moduly - přehled-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc4">Kapitola 4</A>  Moduly - přehled</H1><!--SEC END --><P>Důležitější moduly jsem si rozdělil pro účely této dokumentace do několika částí: data, infrastruktura, prezentace, výpočty. Rozdělení je pouze orientační, hlavně část infrastrukturní a výpočtová se velmi výrazně překrývá.</P><!--TOC section Data-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc5">4.1</A>  Data</H2><!--SEC END --><P>
Jako datové mohu nazvat tyto moduly:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	<TT>Zpravostroj::Word</TT> reprezentuje slovo, u kterého může být případně skóre.<P>	</P></LI><LI CLASS="li-itemize"><TT>Zpravostroj::Article</TT> reprezentuje článek.<P>	</P></LI><LI CLASS="li-itemize"><TT>Zpravostroj::Date</TT> reprezentuje datum.<P>	</P></LI><LI CLASS="li-itemize"><TT>Zpravostroj::RSS</TT> reprezentuje RSS čtečku.
	
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ManualCategorization::ManualCategorization</TT>, <TT>Zpravostroj::ManualCategorization::NewsTopics</TT> a <TT>Zpravostroj::ManualCategorization::Unlimited</TT> slouží k načítání a 
	
</LI></UL><P>	</P><!--TOC section Infrastruktura-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc6">4.2</A>  Infrastruktura</H2><!--SEC END --><P>
Jako infrastrukturní mohu nazvat tyto moduly:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	<TT>Zpravostroj::DateArticles</TT> reprezentuje všechny články jednoho dne.
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::AllDates</TT> reprezentuje všechny dny. 
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Traversable</TT> je zobecnění objektu, který má více podobjektů, které lze postupně načítat a na kterých lze něco postupně spouštět (traverzovat)
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Forker</TT> je objekt, který mi "pomáhá" s paralelizací
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::OutCounter</TT> je objekt, který mi "pomáhá" se sčítáním dat pomocí vnějšího třídění
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::InverseDocumentFrequencies</TT> vrací IDF vektor,
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::TectoClient</TT> a <TT>Zpravostroj::TectoServer</TT> fungují pro lemmatizaci textu
</LI></UL><P>	
	
</P><!--TOC section Výpočet-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc7">4.3</A>  Výpočet</H2><!--SEC END --><P>
Jako výpočtové mohu nazvat tyto moduly:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	<TT>Zpravostroj::Categorizer::Categorizer</TT> je obecný, abstraktní kategorizér
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Categorizer::Evaluator</TT> evaluuje libovolný kategorizér srovnáním s ruční kategorizací
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Categorizer::TotallyRetarded</TT> je triviální kategorizér
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Categorizer::FreqThemes</TT>, <TT>Zpravostroj::Categorizer::StopThemes</TT> a <TT>Zpravostroj::Categorizer::TfIdfThemes</TT> dávají do kategorií podle témat, hledaných pouze z článku samého
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Categorizer::AICategorizer</TT> je učící se kategorizér, který je třeba nejdříve naučit na už určených kategoriích. Používá CPAN modul AI::Categorizer
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Readability</TT> je modul k vyčištění zdrojového HTML a získání obsahu článku
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Updater</TT> stahuje nové články a ukládá je do databáze
</LI></UL><!--TOC section Prezentace-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc8">4.4</A>  Prezentace</H2><!--SEC END --><P>
Jako prezentační mohu chápat tyto moduly:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	<TT>Zpravostroj:HTMLOutput</TT> je modul pro již zmiňovanou Facebook aplikaci, pomocí které lze zatřizovat články do kategorií
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData</TT> je modul, přímo určený pro výstup dat pro bakalářskou práci
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Categorizer::Categorizer</TT> a <TT>Zpravostroj::Categorizer::Evaluator</TT> jsem velmi stručně popsal též výše
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Categorizer::TotallyRetarded</TT> je triviální kategorizér
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Categorizer::FreqThemes</TT>, <TT>Zpravostroj::Categorizer::StopThemes</TT> a <TT>Zpravostroj::Categorizer::TfIdfThemes</TT> dávají do kategorií podle témat, hledaných pouze z článku samého
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::Categorizer::AICategorizer</TT> je učící se kategorizér, který je třeba nejdříve naučit na už určených kategoriích. Používá CPAN modul AI::Categorizer
</LI></UL><!--TOC chapter Popisy jednotlivých modulů-->
<H1 CLASS="chapter"><!--SEC ANCHOR --><A NAME="htoc9">Kapitola 5</A>  Popisy jednotlivých modulů</H1><!--SEC END --><P>V této části popíšu jednotlivé části programu; nechci ale vytvářet „kopii“ komentářů ve zdrojovém kódu, popíši tedy pouze to, co pokládám za opravdu důležité.</P><!--TOC section Data-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc10">5.1</A>  Data</H2><!--SEC END --><P>
		
</P><!--TOC subsection Uložení článků-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc11">5.1.1</A>  Uložení článků</H3><!--SEC END --><P>
		
Články jsou uloženy ve složce <TT>data/articles</TT>, v souboru na adrese <TT>data/articles/Y/M/D/N.bz2</TT>, kde <TT>Y</TT> je rok, <TT>M</TT> je měsíc, <TT>D</TT> je den a <TT>N</TT> je číslo článku. Jsou serializovány pomocí <TT>YAML::XS</TT> a <TT>MooseX::Storage</TT>, a jsou zazipovány programem bzip2.</P><P>Motivace pro zvolení serializace jako způsobu ukládání byla to, že jsem chtěl mít všechna data o článcích "pohromadě", ale neměl jsem k dispozici klasickou databázi. Pohlíženo zpětně nebyla serializace dobrý nápad, protože trvá, spolu se bzipováním, velmi dlouho.</P><P>Bzipování bylo naopak poměrně potřeba - od začátku jsem si chtěl ukládat jak původní HTML kód, tak vyčištěnou část článku, tak všechna slova zlemmatizovaná. Tyto informace v "čistém" textu zabíraly příliš dat, proto jsem radši vše bzipoval.</P><!--TOC subsection <TT>Zpravostroj::Article</TT>-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc12">5.1.2</A>  <TT>Zpravostroj::Article</TT></H3><!--SEC END --><P>Všechny články jsou objekty typu <TT>pravostroj::Article</TT> a různé druhy výpočtu témat mají jako své procedury.</P><P>Pro načtení článku lze použít například metodu modulu <TT>Zpravostroj::AllDates</TT> <TT>Zpravostroj::AllDates::get_from_article_id($id)</TT>, kde <TT>$id</TT> je string ve formátu <TT>Y-M-D-A</TT>, kde <TT>Y</TT> je rok, <TT>M</TT> je měsíc, <TT>D</TT> je den a <TT>A</TT> je číslo článku v daném dni. Pokud jsou součástí projektu už stažené články z roku 2010, je možné jednoduše načíst dva ukázkové články z bakalářské práce pomocí metody modulu <TT>Zpravostroj::ThesisData</TT> <TT>Zpravostroj::ThesisData::get_example_articles()</TT>, která vrací 2 články, které jsou jako ukázkové v bakalářské práci, v perlovském poli.</P><P>Každý článek má tyto metody pro čtení témat:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	<TT>$article-&gt;frequency_themes()</TT> vrací frekvenční témata (pole objektů <TT>Zpravostroj::Word</TT>)
	</LI><LI CLASS="li-itemize"><TT>$article-&gt;stop_themes()</TT> vrací stop-témata (pole objektů <TT>Zpravostroj::Word</TT>)
	</LI><LI CLASS="li-itemize"><TT>$article-&gt;unlimited_manual_tags()</TT> vrací "neomezená" ručně zatřízená témata, pokud jsou (pole textových řetězců)
	</LI><LI CLASS="li-itemize"><TT>$article-&gt;news_topics_manual_tags()</TT> vrací "omezená" ručně zatřízená témata, pokud jsou (pole textových řetězců)
	</LI><LI CLASS="li-itemize"><TT>$article-&gt;has_tf_idf_themes()</TT> je 1 nebo 0 podle toho, jestli článek má, nebo nemá spočítaná TF-IDF témata
	</LI><LI CLASS="li-itemize"><TT>$article-&gt;count_tf_idf_themes($idf_hash, $article_count)</TT> TF-IDF témata spočítá - <TT>$idf_hash</TT> je IDF matice, <TT>$article_count</TT> je počet všech článků, obojí je nepovinné - pokud není zadáno, načte se v <TT>count_tf_idf_themes()</TT>
	</LI><LI CLASS="li-itemize"><TT>$article-&gt;tf_idf_themes()</TT> jsou tato témata (reference na pole objektů <TT>Zpravostroj::Word</TT>)
</LI></UL><P>
	
<TT>Zpravostroj::Word</TT> je objekt, který má metody:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	<TT>$word-&gt;form()</TT> - vrací tvar slova
	</LI><LI CLASS="li-itemize"><TT>$word-&gt;lemma()</TT> - vrací lemma slova
	</LI><LI CLASS="li-itemize"><TT>$word-&gt;score()</TT> - vrací ohodnocení slova jako tématu - u <TT>frequency_themes</TT> a <TT>stop_themes</TT> znamená frekvence, u <TT>tf_idf_themes</TT> znamená hodnotu <TT>tf_idf</TT>
</LI></UL><!--TOC section Infrastruktura-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc13">5.2</A>  Infrastruktura</H2><!--SEC END --><P>
				
</P><!--TOC subsection Forker-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc14">5.2.1</A>  Forker</H3><!--SEC END --><P>
<A NAME="sec:forker"></A>
Při experimentování jsem zjistil, že pro rychlejší a spolehlivější uvolňování paměti po operacích náročných na paměť, jako je například načítání článků, je lepší použít modul <TT>forks</TT>, pomocí něho vytvořit nový proces, náročnější operaci udělat v separátním procesu a výsledky nasdílet zpátky. Program tak uvolní paměť ihned po skončení procesu. (Tento fakt jsem si posléze ověřil i na jiném, nesouvisejícím projektu.)</P><P>Modul <TT>forks</TT> funguje jako "náhrada" vestavěných perl threadů, které ale nejsou příliš praktické. <TT>forks</TT> používá naprosto stejný syntax, jako modul <TT>threads</TT>, včetně sdílení proměnných pomocí <TT>shared</TT> (pro sdílení dat si modul forks vytvoří "nadřazený" proces a např. zámky implementuje pomocí socketů).</P><P>Kromě toho jsem zjistil, že při načítání většího množství článků je "bottleneck" rozbalování z bz2 a deserializace; je ale možné načítání článků mírně paralelizovat tak, že např. při rozbalování jednoho článku může systém zároveň dělat něco jiného, tím i případně využít více jader procesoru, čímž se vše zrychlí.</P><P>Pro tuto paralelizaci ale není možné, aby běželo příliš mnoho procesů najednou. Proto jsem si vytvořil objekt <TT>Zpravostroj::Forker</TT>, který za mě hlídá postupné spouštění forků.</P><P>Funguje tak, že se mu dávají odkazy na subroutiny pomocí <TT>$forker-&gt;run($subroutine)</TT>, tyto si pamatuje v poli jako ve frontě. Z fronty potom postupně subroutiny spouští v separátních forcích tak, aby nebylo zároveň spuštěno víc forků, než má <TT>Forker</TT> povoleno. Počet povolených forků je <TT>Forker</TT>u zadáno při konstrukci.</P><P><TT>Forker</TT> ale nemá, jak by sám tyto forky spouštěl "mimo" běh hlavního programu (není možné určit vlastní fork na spouštění forků, protože odkazy na subroutiny není možno sdílet mezi jednotlivými forky). Proto je nutné po zadání všech subroutin pomocí <TT>$forker-&gt;run()</TT> buď pravidelně spouštět <TT>$forker-&gt;check_waiting()</TT>, který jednou zkontroluje počet běžících forků a případně nějaké další spustí, nebo jednou spustit <TT>$forker-&gt;wait()</TT>, což je funkce, která počká na doběhnutí všech nedoběhnutých forků (která pravidelně spouští <TT>$forker-&gt;check_waiting</TT>). Pokud se jakékoliv výsledky vrací zpátky do nějaké proměnné, která existuje mimo subroutinu, tak tato musí být sdílená přes modul <TT>forks::shared</TT>, jinak se při zapisování (perlí fork funguje na principu copy-on-write) vytvoří <B>kopie</B> této proměnné.</P><P>Forkery mohou být "vnořené" do sebe - tj. v subroutině, kterou dostane a bude spouštět jeden <TT>Forker</TT> může být zase jiný <TT>Forker</TT>. Forkery ale není možno sdílet mezi forky, tj. "vnitřní" Forker musí být v subroutině vytvořen a v ní opět zaniknout. </P><!--TOC subsection Traversable-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc15">5.2.2</A>  Traversable</H3><!--SEC END --><P><TT>Zpravostroj::Traversable</TT> je zobecnění objektu, který má více podobjektů, které lze postupně načítat a na kterých lze něco postupně spouštět (traverzovat). V mém případě jsou to dva objekty - jednak objekt <TT>Zpravostroj::AllDates</TT>, který představuje všechny dny (a který nemá žádné vlastnosti, tj. všechny jeho instance jsou jakoby datově shodné), a objekt Zpravostroj::DateArticles, který představuje všechny články daného dne. V případě <TT>Zpravostroj::AllDates</TT> jsou "podřazené" objekty, přes které se "traverzuje", objekty <TT>Zpravostroj::DateArticles</TT>, objektům <TT>Zpravostroj::DateArticles</TT> jsou zase "podřazené" objekty <TT>Zpravostroj::Article</TT>.</P><P><TT>Zpravostroj::Traversable</TT> je abstraktní třída (v řeči <TT>Moose</TT> "role"), která funguje tak, že všechny podřazené objekty zároveň nikdy nejsou v paměti (protože by se všechny články naráz do paměti nevešly), ale jednak má abstraktní metodu <TT>_get_traversed_array</TT>, která vrátí pole řetězců, které jakoby představují podřazené objekty, a abstraktní metodu <TT>_get_object_from_string</TT>, která objekt z řetězce vyrobí.</P><P>Poté má (neabstraktní) metodu <TT>traverse($sub, $count)</TT>, která dostane odkaz na subroutinu, kterou postupně spouští na každý podřazený objekt. Načtení podobjektu a samotné spuštění subroutiny proběhne v separátním forku, spouštěného pomocí modulu <TT>Zpravostroj::Forker</TT> (viz výše), forků je zároveň povoleno spouštět <TT>$count</TT>. Pokud je <TT>$count</TT> 0 nebo 1, žádné forkování neprobíhá a subroutiny se spouštějí všechny ve stejném procesu. (Nemůžu zde napsat "v hlavním procesu", protože zatímco traverzování přes <TT>AllDates</TT> může forkovat, traverzování přes <TT>DateArticles</TT> nemusí; naopak, stejně jako můžou být Forkery "vnořovány" do sebe, tak může být traverzování vnořováno do sebe).</P><P>Opět, jelikož jsou subroutiny spouštěny přes <TT>Forker</TT>, pokud jsou nějaké výsledky vraceny ven ze subroutiny do nějaké proměnné, je nutné tuto proměnou sdílet mezi forky pomocí forks::shared.</P><P>Kromě toho má <TT>Zpravostroj::Traversable</TT> abstraktní metodu <TT>_after_traverse</TT>, která vždy proběhne na každém podobjektu po spuštění <TT>$sub</TT>. Tato metoda dostane jako parametry to, co vrací <TT>$sub</TT>. Používám to pouze pro ukládání článků po případné změně - návratová hodnota mi potom říká, jestli se článek změnil, nebo nezměnil.</P><!--TOC subsection OutCounter-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc16">5.2.3</A>  OutCounter</H3><!--SEC END --><P>V projektu často potřebuji sečíst velké množství dat, které jsou ve formátu klíč-hodnota (například pro IDF potřebuji zjistit pro jednotlivá slova počet dokumentů, ve kterých se vyskytují). Pro menší množství dat lze použít velký perl hash, do kterého se postupně přičítá; pro větší množství dat se nemusí tento hash vejít do paměti, nebo v případě, že používám metodu forkování, popsanou výše, trvá dlouho sdílení hashů mezi thready a je nutno je nějak zamykat.</P><P>Místo toho lze ale využít vnějšího třídění pomocí unixovského příkazu sort. Všechny dvojice klíč-hodnota postupně vypisuji do souboru, poté seřadím podle klíče a poté jedním průchodem sečtu a rovnou vypisuji sečtené hodnoty. Pokud potřebuji ještě naopak seřadit vše podle hodnot (např. pro nejčastější témata některého typu), znovu použiji příkaz sort.</P><P>Všechny výše popsané úkony dělám pomocí objektu <TT>Zpravostroj::OutCounter</TT>, kterému při vytvoření řeknu cestu k souboru, kam má zapisovat, a binární příznak, jestli má při už existující soubor smazat, nebo ne. Podrobněji je postup popsán v komentářích tohoto modulu.</P><!--TOC section Výpočty, prezentace-->
<H2 CLASS="section"><!--SEC ANCHOR --><A NAME="htoc17">5.3</A>  Výpočty, prezentace</H2><!--SEC END --><!--TOC subsection Postup zpracovávání článků-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc18">5.3.1</A>  Postup zpracovávání článků</H3><!--SEC END --><P>O stahování nových článků se "stará" modul <TT>Zpravostroj::Updater</TT>. Pro stáhnutí nových článků do archivu stačí spustit <TT>Zpravostroj::Updater::download_new_articles($recount_all_tf_idf_themes)</TT>.</P><P>Tato procedura stáhne nové články, slova převede na lemmata a spočítá je, články také pro všechna jejich slova přidá do IDF matice, články poté uloží do data/articles.</P><P><TT>$recount_all_tf_idf_themes</TT> je volitelná proměnná, která, pokud je rovná 1, spustí update všech tf-idf témat podle nově přidaných slov do IDF matice (při velkém počtu článků může trvat velmi dlouho, proto je defaultně nastavena jako 0).</P><P>Nejprve je jím spuštěn <TT>Zpravostroj::TectoServer</TT>, což je separátní fork (více o forcích v části <A HREF="#sec:forker">5.2.1</A>), ve kterém běží <TT>TectoMT</TT>.</P><P>Potom jsou staženy adresy článků pomocí modulu <TT>Zpravostroj::RSS</TT> (adresy RSS kanálů a adresy stažených článků jsou v adresáři <TT>data/articles/RSS</TT>). Poté je článek stáhnut pomocí modulu <TT>Zpravostroj::WebReader</TT>, poté se pomocí <TT>Zpravostroj::Readability</TT> z HTML zdroje získá samotný článek bez okolních textů. Poté se modul <TT>Zpravostroj::TectoClient</TT> spojí s <TT>TectoServer</TT>em a pošle mu slova ve článku; <TT>TectoServer</TT> tato zlemmatizuje a určí pojmenované entity.</P><P>Tato "kaskáda" operací se spouští díky Moose konstruktoru v modulu <TT>Zpravostroj::Article</TT>.</P><P>Články jsou poté uloženy pomocí subrutiny <TT>Zpravostroj::Globals::dump_bz2</TT>.</P><P>Kromě toho jsou v adresáři archivedumpers/ skripty, které stahují články z jednotlivých serverů z archivu - tyto ale určitě nefungují - jednak proto, že i vnitřní API programu se od doby, co byly napsány, změnilo, a jednak proto, že HTML na daných serverech už se změnilo a nebylo updatováno; tyto skripty mám jako součást programu tedy spíše pro zajímavost a úplnost.</P><!--TOC subsection Tf-Idf témata-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc19">5.3.2</A>  Tf-Idf témata</H3><!--SEC END --><P>Pro TF-IDF témata je nejprve nutné znát IDF vektor (podrobněji viz bakalářská práce); tento lze načíst pomocí modulu <TT>Zpravostroj::InverseDocumentFrequencies</TT>, který si vektor ukládá v adresáři data/idf.</P><P>Pokud IDF vektor není znám, je možné jej také spočítat pomocí <TT>Zpravostroj::InverseDocumentFrequencies</TT>; pokud už spočítaný je, ale přibydou nové články, není nutné jej celý přepočítávat - modul <TT>Zpravostroj::InverseDocumentFrequencies</TT> si pamatuje poslední článek, který byl započítán, a přidá všechny novější.</P><P>Pokud by bylo potřeba opravdu přepočítat celý IDF vektor znovu, je nutné smazat celý adresář <TT>data/idf/</TT>.</P><P>Pokud chci článku vypočítat TF-IDF témata, je třeba článek načíst, spustit na něj <TT>count_tf_idf_themes</TT> a znovu ho uložit; toto dělá <TT>Zpravostroj::AllDates::get_statistics_tf_idf_themes</TT>.</P><!--TOC subsection Evaluace-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc20">5.3.3</A>  Evaluace</H3><!--SEC END --><P>Různé klasifikátory lze evaluovat pomocí modulu <TT>Zpravostroj::Categorizer::Evaluator</TT> a podtříd modulu <TT>Zpravostroj::Categorizer</TT>. Aby ale nebylo třeba zadávat všechny parametry znovu, je již předpřipravena evaluace s parametry, které byly použity v bakalářské práci, v modulu <TT>Zpravostroj::ThesisData</TT>, a to následovně:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	<TT>Zpravostroj::ThesisData::try_trivial</TT> vyzkouší triviální zatřizování do kategorie "ODS"
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::try_f_themes</TT> vyzkouší zatřizování do frekvenčních témat
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::try_stop_themes</TT> vyzkouší zatřizování do stop témat
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::try_tf_idf_themes</TT> vyzouší zatřizování do tf-idf témat
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::try_categorizer</TT> zkusí různé "skutečné" kategorizéry se strojovým učením s různými parametry. Pozor, trvá velmi dlouho (na mém stroji kolem 6 hodin)
</LI></UL><P>
Všechny zkoušky už rovnou vypisují TeXovské řetězce, kde na každém řádku jsou procenta úspěšnosti v pořadí: micro ro, micro pi, micro F, macro ro, macro pi, macro F. Pozor, tyto řetězce jsou vypsány na obrazovku pomocí stejných metod, jako vypisuji kontrolní výpisy, tedy <TT>Zpravostroj::Globals::_shut_up()</TT> vypne i výsledné výpisy. Uznávám, že toto řešení není příliš čisté a do budoucna by bylo lepší jej změnit.</P><P>Tuto evaluaci popisuji poměrně podrobně v bakalářské práci.</P><!--TOC subsection Statistiky, grafy-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc21">5.3.4</A>  Statistiky, grafy</H3><!--SEC END --><P>Počítání většiny statistik je jakoby "dvojúrovňové". První, časově výrazně náročnější část je průchod všemi články v archivu, kdy pro každý den se daná statistika uloží do adresáře data/daycounters a ještě v tomto kroku se z těchto denních statistik spočítají statistiky pro celý archiv. Konkrétně se například ukládá pro každý den statistika všech tf-idf témat.</P><P>Druhá část je pak velmi rychlý průchod těmito výsledky a vykreslení některých statistik do grafu v PDF - například historie vybraného tf-idf tématu. PDF soubory jsou ukládány do adresáře R_graphs/, data, potřebná pro kreslení těchto grafů, jsou v adresáři <TT>data/R_data</TT>.</P><P>První úroveň se spouští veškerá přes modul Zpravostroj::AllDates, a to následovně:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	<TT>Zpravostroj::AllDates::get_statistics_f_themes()</TT> spočítá f-témata u článků, ukládá statistiky do souborů <TT>data/daycounters/f_themes_Y-M-D</TT>, a statistiky všech f-témat ukládá do souboru <TT>data/allresults/f_themes_counted_sorted_by_frequency</TT>
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::AllDates::get_statistics_stop_themes()</TT> spočítá stop-témata u článků, ukládá statistiky do souborů <TT>data/daycounters/stop_themes_Y-M-D</TT>, a statistiky všech stop-témat ukládá do souboru <TT>data/allresults/stop_themes_counted_sorted_by_frequency</TT>
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::AllDates::get_statistics_news_source()</TT> spočítá zpravodajské zdroje u článků, ukládá statistiky do souborů <TT>data/daycounters/news_source_Y-M-D</TT>, a statistiky všech f-témat ukládá do souboru <TT>data/allresults/news_source_counted_sorted_by_frequency</TT>
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::AllDates::get_statistics_tf_idf_themes()</TT> spočítá pro každý článek tf-idf témata, uloží je zpět do článku, statistiky denních tf-idf témat uloží do souborů <TT>data/daycounters/tf_idf_Y-M-D</TT> a všech do <TT>data/allresults/tf_idf_counted_sorted_by_frequency</TT>
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::AllDates::get_most_frequent_lemmas</TT> spočítá nejčastější lemmata, denní výsledky ale neukládá, uloží pouze výsledky z celého archivu a uloží je do <TT>data/allresults/lemmas_counted_sorted_by_frequency</TT>
</LI></UL><P>Druhá úroveň už je celá v modulu Zpravostroj::ThesisData (název je ThesisData proto, že jdou vykreslit v podstatě pouze ty grafy, které mám v bakalářské práci), a to následovně:
</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	<TT>Zpravostroj::ThesisData::graph_average_stop_themes_on_article()</TT> vykreslí průměrný počet stoptémat na článek na den
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::graph_average_tf_idf_themes_on_article()</TT> vykreslí průměrný počet tf-idf témat na článek na den
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::graph_article_count()</TT> vykreslí průměrný počet článků na den
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::graph_news_source()</TT> vykreslí poměr článků z různých zdrojů na den
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::graph_lemma_count()</TT> vykreslí počty lemmat do grafu
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::graph_selected_words($result_name, $type, $smooth, $words_ref, $colors_ref, $max, $lines_ref, $from, $to, $width, $height)</TT> vykreslí historii <TT>$type</TT>-témat <TT>$words_ref</TT> barvami <TT>$colors_ref</TT> do grafu v souboru <TT>$result_name</TT>, parametr <TT>$smooth</TT> určuje, jestli bude graf vyhlazený, <TT>$max</TT> určuje maximální Y v grafu, <TT>$lines_ref</TT> umístění horizontálních čar, <TT>$from</TT> a <TT>$to</TT> případné "přiblížení" a <TT>$width</TT> a <TT>$height</TT> velikost grafu v palcích
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::graph_selected_words_from_thesis($type)</TT> spustí předcházející proceduru s takovými parametry, aby odpovídala grafům v bakalářské práci, kde <TT>$type</TT> je číslo od 1 do 8
</LI></UL><P>
		
</P><!--TOC subsection Další data-->
<H3 CLASS="subsection"><!--SEC ANCHOR --><A NAME="htoc22">5.3.5</A>  Další data</H3><!--SEC END --><P>
<TT>Zpravostroj::ThesisData</TT> ještě vypisuje další data pro bakalářskou práci, a to následovně:</P><UL CLASS="itemize"><LI CLASS="li-itemize">
	<TT>Zpravostroj::ThesisData::example_unlimited_manual_tags()</TT> vypisuje pro ukázkové články moje "neomezené" manuální tagy
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::example_text()</TT> vypisuje pro ukázkové články jejich text
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::example_f_themes()</TT> vypisuje pro ukázkové články jejich frekvenční témata
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::example_stop_themes()</TT> vypisuje pro ukázkové články jejich stop témata
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::example_tf_idf_themes()</TT> vypisuje pro ukázkové články jejich tf-idf témata
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::most_frequent_f_themes()</TT> vypisuje nejčastější frekvenční témata
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::most_frequent_stop_themes()</TT> vypisuje nejčastější frekvenční témata
	</LI><LI CLASS="li-itemize"><TT>Zpravostroj::ThesisData::most_frequent_tf_idf_themes()</TT> vypisuje nejčastější tf-idf témata
</LI></UL><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<HR SIZE=2><BLOCKQUOTE CLASS="quote"><EM>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</EM><A HREF="http://hevea.inria.fr/index.html"><EM>H</EM><EM><FONT SIZE=2><sup>E</sup></FONT></EM><EM>V</EM><EM><FONT SIZE=2><sup>E</sup></FONT></EM><EM>A</EM></A><EM>.</EM></BLOCKQUOTE></BODY>
</HTML>
