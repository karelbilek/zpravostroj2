<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>
			Dokumentace k projektu Zpravostroj - uživatelská část
		</title>
	</head>
	<body>
		<h1>
			Dokumentace k projektu Zpravostroj - uživatelská část
		</h1>
		<p>
			<a href="index.html">Zpět</a>
		</p>
		<hr>
		
		<h2>
			Instalace
		</h2>
		<p>
			Celý projekt je pouze několik perl modulů. Pro spuštění jednotlivých úloh je nutné daný modul načíst pomocí příkazů use nebo require, přičemž musí být "hlavní adresář" (tj. adresář, nadřazený adresáři Zpravostroj) v PERL5LIB - jelikož je ale v PERL5LIB většinou obsažen odkaz na pracovní adresář <code>.</code>, stačí mít hlavní adresář jako pracovní adresář.
		</p>
		<p>
			Po načtení modulu (různé moduly pro různé úkoly) je možné různé úkoly spustit jedním zavoláním procedury. Kromě modulu <code>Zpravostroj::Globals</code> neexportuje žádný z modulů žádné procedury, je tedy nutné psát celé názvy procedur včetně názvu modulu.
		</p>
		<p>
			Program vypisuje velké množství pracovních výpisů na standardní výstup; toto je možné vypnout spuštěním procedury <code>Zpravostroj::Globals::_shut_up()</code>. Všechny kontrolní výpisy programu jsou v kódování utf-8.
		</p>
		<p>
			Všechna data (články, výsledky analýz) zapisuje a čte program do adresáře <code>./data/</code>, tj. umístění je závislé na pracovním adresáři. Pokud jsou součástí projektu i stažené články (jsou na DVD k bakalářské práci, ale kvůli copyrightu je nezveřejňuji na veřejném git repository), jsou v adresáři <code>data</code>, který je podadresář hlavního adresáře, je tedy nutné mít hlavní adresář jako pracovní.
		</p>
		<p>
			Stejně tak je pro kreslení grafů (viz níže) nutné mít jako podadresář pracovního adresáře adresář "/R_graphs", který obsahuje zdrojové kódy v jazyce R pro kreslení grafů.
		</p>
		<p>
			Velmi tedy doporučuji mít jako pracovní adresář "hlavní adresář" projektu.
		</p>
		<p>
			Program též zapisuje průběžná data do adresáře <code>./tmp/</code> pod pracovní adresář. Pokud chcete, aby program zapisoval do adresáře <code>/tmp</code> (například), je nutné tento adresář nalinkovat do pracovního adresáře jako <code>./tmp/</code>.
		</p>
		<p>
			Součástí projektu je i aplikace pro manuální označování témat, která byla původně zamýšlena jako webová aplikace pro více uživatelů, proto běží jako Facebook aplikace na adrese <a href="http://apps.facebook.com/zpravostroj_z/">http://apps.facebook.com/zpravostroj_z/</a>; tato aplikace je ale ve skutečnosti umístěna na serveru ufallab2.ms.mff.cuni.cz, který bude v průběhu roku 2011 vypnut a fungovat tedy přestane. Zdrojový kód k této Facebook aplikaci je modul <code>Zpravostroj::HTMLOutput</code> (a velmi krátký skript, který spustí <code>Zpravostroj::HTMLOutput::generate_HTML</code>, který není součástí projektu).
		</p>
		<h2>
			Stahování nových článků
		</h2>
		<p>
			Stahování nových článků má "na starosti" modul <code>Zpravostroj::Updater</code>. Pro stáhnutí nových článků do archivu stačí spustit<br>
			<code>Zpravostroj::Updater::download_new_articles($recount_all_tf_idf_themes)</code><br>
			<br>
			Tato procedura stáhne nové články, slova převede na lemmata a spočítá je, články také pro všechna jejich slova přidá do IDF matice, články poté uloží do data/articles.
		</p>
		<p>
			<code>$recount_all_tf_idf_themes</code> je volitelná proměnná, která, pokud je rovná 1, spustí update všech tf-idf témat podle nově přidaných slov do IDF matice (při velkém počtu článků může trvat velmi dlouho, proto je defaultně nastavena jako 0).
		</p>
		<p>
			Kromě toho jsou v adresáři archivedumpers/ skripty, které stahují články z jednotlivých serverů z archivu - tyto ale určitě nefungují - jednak proto, že i vnitřní API programu se od doby, co byly napsány, změnilo, a jednak proto, že HTML na daných serverech už se změnilo a nebylo updatováno; tyto skripty mám jako součást programu tedy spíše pro zajímavost a úplnost.
		</p>
		<h2>
			Témata u jednotlivých článků
		</h2>
		<p>
			Všechny články jsou objekty typu Zpravostroj::Article a různé druhy výpočtu témat mají jako své procedury.
		</p>
		<p>
			Pro načtení článku lze použít například metodu modulu Zpravostroj::AllDates <code>Zpravostroj::AllDates::get_from_article_id($id)</code><br>
			<br>
			kde <code>$id</code> je string ve formátu "Y-M-D-A", kde Y je rok, M je měsíc, D je den a A je číslo článku v daném dni. Pokud jsou součástí projektu už stažené články z roku 2010, je možné jednoduše načíst dva ukázkové články z bakalářské práce pomocí metody modulu <code>Zpravostroj::ThesisData</code><br>
			<code>Zpravostroj::ThesisData::get_example_articles()</code><br>
			<br>
			která vrací 2 články, které jsou jako ukázkové v bakalářské práci, v perlovském poli.
		</p>
		<p>
			Každý článek má tyto metody pro čtení témat:<br>
		</p>
		<ul>
			<li>
				<code>$article-&gt;frequency_themes()</code>vrací frekvenční témata (pole objektů Zpravostroj::Word)
			</li>
			<li>
				<code>$article-&gt;stop_themes()</code>vrací stop-témata (pole objektů Zpravostroj::Word)
			</li>
			<li>
				<code>$article-&gt;unlimited_manual_tags()</code> vrací "neomezená" ručně zatřízená témata, pokud jsou (pole textových řetězců)
			</li>
			<li>
				<code>$article-&gt;news_topics_manual_tags()</code> vrací "omezená" ručně zatřízená témata, pokud jsou (pole textových řetězců)
			</li>
			<li>
				<code>$article-&gt;has_tf_idf_themes()</code> je 1 nebo 0 podle toho, jestli článek má, nebo nemá spočítaná TF-IDF témata
			</li>
			<li>
				<code>$article-&gt;count_tf_idf_themes($idf_hash, $article_count)</code>TF-IDF témata spočítá - $idf_hash je IDF matice, $article_count je počet všech článků, obojí je nepovinné - pokud není zadáno, načte se v count_tf_idf_themes()
			</li>
			<li>
				<code>$article-&gt;tf_idf_themes()</code> jsou tato témata (reference na pole objektů Zpravostroj::Word)
			</li>
		</ul>
		<p>
			<code>Zpravostroj::Word</code> je objekt, který má metody:
		</p>
		<ul>
			<li>
				<code>$word-&gt;form()</code> - vrací tvar slova
			</li>
			<li>
				<code>$word-&gt;lemma()</code> - vrací lemma slova
			</li>
			<li>
				<code>$word-&gt;score()</code> - vrací ohodnocení slova jako tématu - u frequency_themes a stop_themes znamená frekvence, u tf_idf_themes znamená hodnotu tf_idf
			</li>
		</ul>
		<h2>
			Statistiky, grafy
		</h2>
		<p>
			Počítání většiny statistik je jakoby "dvojúrovňové". První, časově výrazně náročnější část je průchod všemi články v archivu, kdy pro každý den se daná statistika uloží do adresáře data/daycounters a ještě v tomto kroku se z těchto denních statistik spočítají statistiky pro celý archiv. Konkrétně se například ukládá pro každý den statistika všech tf-idf témat.
		</p>
		<p>
			Druhá část je pak velmi rychlý průchod těmito výsledky a vykreslení některých statistik do grafu v PDF - například historie vybraného tf-idf tématu. PDF soubory jsou ukládány do adresáře R_graphs/, data, potřebná pro kreslení těchto grafů, jsou v adresáři <code>data/R_data</code>.
		</p>
		<p>
			První úroveň se spouští veškerá přes modul Zpravostroj::AllDates, a to následovně:
		</p>
		<ul>
			<li>
				<code>Zpravostroj::AllDates::get_statistics_f_themes()</code> spočítá f-témata u článků, ukládá statistiky do souborů <code>data/daycounters/f_themes_Y-M-D</code>, a statistiky všech f-témat ukládá do souboru <code>data/allresults/f_themes_counted_sorted_by_frequency</code>
			</li>
			<li>
				<code>Zpravostroj::AllDates::get_statistics_stop_themes()</code> spočítá stop-témata u článků, ukládá statistiky do souborů <code>data/daycounters/stop_themes_Y-M-D</code>, a statistiky všech stop-témat ukládá do souboru <code>data/allresults/stop_themes_counted_sorted_by_frequency</code>
			</li>
			<li>
				<code>Zpravostroj::AllDates::get_statistics_news_source()</code> spočítá zpravodajské zdroje u článků, ukládá statistiky do souborů <code>data/daycounters/news_source_Y-M-D</code>, a statistiky všech f-témat ukládá do souboru <code>data/allresults/news_source_counted_sorted_by_frequency</code>
			</li>
			<li>
				<code>Zpravostroj::AllDates::get_statistics_tf_idf_themes()</code> spočítá pro každý článek tf-idf témata, uloží je zpět do článku, statistiky denních tf-idf témat uloží do souborů <code>data/daycounters/tf_idf_Y-M-D</code> a všech do <code>data/allresults/tf_idf_counted_sorted_by_frequency</code>
			</li>
			<li>
				<code>Zpravostroj::AllDates::get_most_frequent_lemmas</code> spočítá nejčastější lemmata, denní výsledky ale neukládá, uloží pouze výsledky z celého archivu a uloží je do <code>data/allresults/lemmas_counted_sorted_by_frequency</code>
			</li>
		</ul>
		<p>
			Druhá úroveň už je celá v modulu Zpravostroj::ThesisData (název je ThesisData proto, že jdou vykreslit v podstatě pouze ty grafy, které mám v bakalářské práci), a to následovně:
		</p>
		<ul>
			<li>
				<code>Zpravostroj::ThesisData::graph_average_stop_themes_on_article()</code> vykreslí průměrný počet stoptémat na článek na den
			</li>
			<li>
				<code>Zpravostroj::ThesisData::graph_average_tf_idf_themes_on_article()</code> vykreslí průměrný počet tf-idf témat na článek na den
			</li>
			<li>
				<code>Zpravostroj::ThesisData::graph_article_count()</code> vykreslí průměrný počet článků na den
			</li>
			<li>
				<code>Zpravostroj::ThesisData::graph_news_source()</code> vykreslí poměr článků z různých zdrojů na den
			</li>
			<li>
				<code>Zpravostroj::ThesisData::graph_lemma_count()</code> vykreslí počty lemmat do grafu
			</li>
			<li>
				<code>Zpravostroj::ThesisData::graph_selected_words($result_name, $type, $smooth, $words_ref, $colors_ref, $max, $lines_ref, $from, $to, $width, $height)</code> vykreslí historii <code>$type</code>-témat <code>$words_ref</code> barvami <code>$colors_ref</code> do grafu v souboru <code>$result_name</code>, parametr <code>$smooth</code> určuje, jestli bude graf vyhlazený, <code>$max</code> určuje maximální Y v grafu, <code>$lines_ref</code> umístění horizontálních čar, <code>$from</code> a <code>$to</code> případné "přiblížení" a <code>$width</code> a <code>$height</code> velikost grafu v palcích
			</li>
			<li>
				<code>Zpravostroj::ThesisData::graph_selected_words_from_thesis($type)</code> spustí předcházející proceduru s takovými parametry, aby odpovídala grafům v bakalářské práci, kde <code>$type</code> je číslo od 1 do 8
			</li>
		</ul>
		<h2>
			Evaluace
		</h2>
		<p>
			Různé klasifikátory lze evaluovat pomocí modulu <code>Zpravostroj::Categorizer::Evaluator</code> a podtříd modulu <code>Zpravostroj::Categorizer</code>. Aby ale nebylo třeba zadávat všechny parametry znovu, je již předpřipravena evaluace s parametry, které byly použity v bakalářské práci, v modulu <code>Zpravostroj::ThesisData</code>, a to následovně:
		</p>
		<ul>
			<li>
				<code>Zpravostroj::ThesisData::try_trivial</code> vyzkouší triviální zatřizování do kategorie "ODS"
			</li>
			<li>
				<code>Zpravostroj::ThesisData::try_f_themes</code> vyzkouší zatřizování do frekvenčních témat
			</li>
			<li>
				<code>Zpravostroj::ThesisData::try_stop_themes</code> vyzkouší zatřizování do stop témat
			</li>
			<li>
				<code>Zpravostroj::ThesisData::try_tf_idf_themes</code> vyzouší zatřizování do tf-idf témat
			</li>
			<li>
				<code>Zpravostroj::ThesisData::try_categorizer</code> zkusí různé "skutečné" kategorizéry se strojovým učením s různými parametry. Pozor, trvá velmi dlouho (na mém stroji kolem 6 hodin)
			</li>
		</ul>
		<p>
			Všechny zkoušky už rovnou vypisují TeXovské řetězce, kde na každém řádku jsou procenta úspěšnosti v pořadí: micro ro, micro pi, micro F, macro ro, macro pi, macro F. Pozor, tyto řetězce jsou vypsány na obrazovku pomocí stejných metod, jako vypisuji kontrolní výpisy, tedy <code>Zpravostroj::Globals::_shut_up()</code> vypne i výsledné výpisy. Uznávám, že toto řešení není příliš čisté a do budoucna by bylo lepší jej změnit.
		</p>
		<h2>
			Další data
		</h2>
		<p>
			<code>Zpravostroj::ThesisData</code> ještě vypisuje další data pro bakalářskou práci, a to následovně:
		</p>
		<ul>
			<li>
				<code>Zpravostroj::ThesisData::example_unlimited_manual_tags()</code> vypisuje pro ukázkové články moje "neomezené" manuální tagy
			</li>
			<li>
				<code>Zpravostroj::ThesisData::example_text()</code> vypisuje pro ukázkové články jejich text
			</li>
			<li>
				<code>Zpravostroj::ThesisData::example_f_themes()</code> vypisuje pro ukázkové články jejich frekvenční témata
			</li>
			<li>
				<code>Zpravostroj::ThesisData::example_stop_themes()</code> vypisuje pro ukázkové články jejich stop témata
			</li>
			<li>
				<code>Zpravostroj::ThesisData::example_tf_idf_themes()</code> vypisuje pro ukázkové články jejich tf-idf témata
			</li>
			<li>
				<code>Zpravostroj::ThesisData::most_frequent_f_themes()</code> vypisuje nejčastější frekvenční témata
			</li>
			<li>
				<code>Zpravostroj::ThesisData::most_frequent_stop_themes()</code> vypisuje nejčastější frekvenční témata
			</li>
			<li>
				<code>Zpravostroj::ThesisData::most_frequent_tf_idf_themes()</code> vypisuje nejčastější tf-idf témata
			</li>
		</ul>
	</body>
</html>
